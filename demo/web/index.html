<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Think First AI - Demo</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      color: white;
      text-align: center;
      margin-bottom: 30px;
      font-size: 2.5em;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
    }

    .controls {
      background: white;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .input-group {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }

    input[type="text"] {
      flex: 1;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 5px;
      font-size: 16px;
    }

    input[type="text"]:focus {
      outline: none;
      border-color: #667eea;
    }

    button {
      padding: 12px 24px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: background 0.3s;
    }

    button:hover {
      background: #5568d3;
    }

    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .status {
      display: flex;
      gap: 20px;
      margin-top: 10px;
    }

    button.active {
      background: #4caf50;
    }

    button.active:hover {
      background: #45a049;
    }

    .status-item {
      flex: 1;
      padding: 10px;
      border-radius: 5px;
      text-align: center;
      font-weight: 600;
    }

    .status-item.connected {
      background: #4caf50;
      color: white;
    }

    .status-item.disconnected {
      background: #f44336;
      color: white;
    }

    .panels {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .panel {
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
    }

    .panel h2 {
      color: #333;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #e0e0e0;
    }

    .panel-content {
      flex: 1;
      overflow-y: auto;
      max-height: 500px;
      padding: 10px;
      background: #f9f9f9;
      border-radius: 5px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      line-height: 1.6;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .thoughts-panel .panel-content {
      color: #667eea;
    }

    .outputs-panel .panel-content {
      color: #764ba2;
    }

    .error {
      color: #f44336;
      background: #ffebee;
      padding: 10px;
      border-radius: 5px;
      margin-top: 10px;
    }

    @media (max-width: 768px) {
      .panels {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>ðŸ§  Think First AI</h1>

    <div class="controls">
      <div class="input-group">
        <input type="text" id="promptInput" placeholder="Enter your prompt here..." />
        <button id="sendBtn" onclick="sendPrompt()">Send</button>
        <button id="wakeUpBtn" onclick="toggleWakeUp()">Wake Up</button>
      </div>
      <div class="status">
        <div id="thoughtsStatus" class="status-item disconnected">Thoughts: Disconnected</div>
        <div id="outputsStatus" class="status-item disconnected">Outputs: Disconnected</div>
        <div id="wakeUpStatus" class="status-item disconnected">AI: Sleeping</div>
      </div>
    </div>

    <div class="panels">
      <div class="panel thoughts-panel">
        <h2>ðŸ’­ Thoughts</h2>
        <div id="thoughtsContent" class="panel-content"></div>
      </div>
      <div class="panel outputs-panel">
        <h2>ðŸ“¤ Outputs</h2>
        <div id="outputsContent" class="panel-content"></div>
      </div>
    </div>
  </div>

  <script>
    let thoughtsWS = null;
    let outputsWS = null;
    let wakeUpWS = null;
    let thoughtsContent = '';
    let outputsContent = '';
    let isAwake = false;

    function connectWebSockets() {
      // Connect to thoughts WebSocket
      thoughtsWS = new WebSocket('ws://localhost:8000/ws/thoughts');

      thoughtsWS.onopen = () => {
        document.getElementById('thoughtsStatus').textContent = 'Thoughts: Connected';
        document.getElementById('thoughtsStatus').className = 'status-item connected';
      };

      thoughtsWS.onmessage = (event) => {
        const data = JSON.parse(event.data);
        if (data.type === 'thought') {
          thoughtsContent += data.content;
          document.getElementById('thoughtsContent').textContent = thoughtsContent;
          if (data.done) {
            thoughtsContent = '';
          }
        } else if (data.type === 'error') {
          document.getElementById('thoughtsContent').innerHTML =
            `<div class="error">Error: ${data.message}</div>`;
        }
      };

      thoughtsWS.onerror = () => {
        document.getElementById('thoughtsStatus').textContent = 'Thoughts: Error';
        document.getElementById('thoughtsStatus').className = 'status-item disconnected';
      };

      thoughtsWS.onclose = () => {
        document.getElementById('thoughtsStatus').textContent = 'Thoughts: Disconnected';
        document.getElementById('thoughtsStatus').className = 'status-item disconnected';
        // Reconnect after 3 seconds
        setTimeout(connectWebSockets, 3000);
      };

      // Connect to outputs WebSocket
      outputsWS = new WebSocket('ws://localhost:8000/ws/outputs');

      outputsWS.onopen = () => {
        document.getElementById('outputsStatus').textContent = 'Outputs: Connected';
        document.getElementById('outputsStatus').className = 'status-item connected';
      };

      outputsWS.onmessage = (event) => {
        const data = JSON.parse(event.data);
        if (data.type === 'output') {
          outputsContent += data.content;
          document.getElementById('outputsContent').textContent = outputsContent;
          if (data.done) {
            outputsContent = '';
          }
        } else if (data.type === 'user_message') {
          // Message from AI via tool call
          const timestamp = data.timestamp ? new Date(data.timestamp).toLocaleTimeString() : '';
          outputsContent += `[${timestamp}] ${data.content}\n\n`;
          document.getElementById('outputsContent').textContent = outputsContent;
        } else if (data.type === 'error') {
          document.getElementById('outputsContent').innerHTML =
            `<div class="error">Error: ${data.message}</div>`;
        }
      };

      outputsWS.onerror = () => {
        document.getElementById('outputsStatus').textContent = 'Outputs: Error';
        document.getElementById('outputsStatus').className = 'status-item disconnected';
      };

      outputsWS.onclose = () => {
        document.getElementById('outputsStatus').textContent = 'Outputs: Disconnected';
        document.getElementById('outputsStatus').className = 'status-item disconnected';
        // Reconnect after 3 seconds
        setTimeout(connectWebSockets, 3000);
      };

      // Connect to wake up WebSocket
      wakeUpWS = new WebSocket('ws://localhost:8000/ws/wakeup');

      wakeUpWS.onopen = () => {
        document.getElementById('wakeUpStatus').textContent = 'AI: Connected';
        document.getElementById('wakeUpStatus').className = 'status-item connected';
      };

      wakeUpWS.onmessage = (event) => {
        const data = JSON.parse(event.data);

        if (data.type === 'status') {
          // Update status display
          const statusEl = document.getElementById('wakeUpStatus');
          statusEl.textContent = `AI: ${data.message}`;
          statusEl.className = 'status-item connected';
        } else if (data.type === 'invocation') {
          // New LLM invocation started
          const statusEl = document.getElementById('wakeUpStatus');
          statusEl.textContent = `AI: Thinking (${new Date(data.timestamp).toLocaleTimeString()})`;
          statusEl.className = 'status-item connected';
        } else if (data.type === 'thought_start') {
          // New thought starting, clear previous content
          thoughtsContent = '';
          document.getElementById('thoughtsContent').textContent = '';
        } else if (data.type === 'thought_chunk') {
          // Stream thought chunks to thoughts panel
          thoughtsContent += data.content;
          document.getElementById('thoughtsContent').textContent = thoughtsContent;
        } else if (data.type === 'tool_call') {
          // Tool was called
          const statusEl = document.getElementById('wakeUpStatus');
          statusEl.textContent = `AI: Sent message to user (${new Date(data.timestamp).toLocaleTimeString()})`;
          statusEl.className = 'status-item connected';
        } else if (data.type === 'error') {
          document.getElementById('wakeUpStatus').textContent = 'AI: Error';
          document.getElementById('wakeUpStatus').className = 'status-item disconnected';
        }
      };

      wakeUpWS.onerror = () => {
        document.getElementById('wakeUpStatus').textContent = 'AI: Error';
        document.getElementById('wakeUpStatus').className = 'status-item disconnected';
      };

      wakeUpWS.onclose = () => {
        document.getElementById('wakeUpStatus').textContent = 'AI: Disconnected';
        document.getElementById('wakeUpStatus').className = 'status-item disconnected';
        // Reconnect after 3 seconds
        setTimeout(connectWebSockets, 3000);
      };
    }

    function sendPrompt() {
      const prompt = document.getElementById('promptInput').value.trim();
      if (!prompt) return;

      if (thoughtsWS && thoughtsWS.readyState === WebSocket.OPEN) {
        thoughtsWS.send(JSON.stringify({ type: 'generate', prompt }));
      }

      if (outputsWS && outputsWS.readyState === WebSocket.OPEN) {
        outputsWS.send(JSON.stringify({ type: 'generate', prompt }));
      }

      // Clear input
      document.getElementById('promptInput').value = '';
    }

    function toggleWakeUp() {
      if (!wakeUpWS || wakeUpWS.readyState !== WebSocket.OPEN) {
        alert('Wake up WebSocket is not connected. Please wait for connection.');
        return;
      }

      const btn = document.getElementById('wakeUpBtn');

      if (!isAwake) {
        // Wake up
        isAwake = true;
        btn.textContent = 'Sleep';
        btn.classList.add('active');
        wakeUpWS.send(JSON.stringify({ type: 'wake_up' }));
      } else {
        // Sleep
        isAwake = false;
        btn.textContent = 'Wake Up';
        btn.classList.remove('active');
        wakeUpWS.send(JSON.stringify({ type: 'sleep' }));
      }
    }

    // Allow Enter key to send
    document.getElementById('promptInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        sendPrompt();
      }
    });

    // Connect on page load
    connectWebSockets();
  </script>
</body>

</html>